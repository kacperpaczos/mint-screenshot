From 13363f22fd3096145a7672a07b4dfe688de120f8 Mon Sep 17 00:00:00 2001
From: Abhimanyu Maurya <aerma7309@gmail.com>
Date: Sun, 3 Apr 2022 16:22:53 +0530
Subject: [PATCH] added configuration option for flash

---
 data/org.gnome.gnome-screenshot.gschema.xml | 5 +++++
 src/screenshot-application.c                | 6 ++++++
 src/screenshot-backend-shell.c              | 6 +++---
 src/screenshot-config.c                     | 7 ++++++-
 src/screenshot-config.h                     | 2 ++
 5 files changed, 22 insertions(+), 4 deletions(-)

diff --git a/data/org.gnome.gnome-screenshot.gschema.xml b/data/org.gnome.gnome-screenshot.gschema.xml
index 63435cc..ae1cd2e 100644
--- a/data/org.gnome.gnome-screenshot.gschema.xml
+++ b/data/org.gnome.gnome-screenshot.gschema.xml
@@ -30,6 +30,11 @@
       <default>false</default>
       <summary>Include Pointer</summary>
       <description>Include the pointer in the screenshot</description>
+    </key>
+     <key name="no-flash" type="b">
+      <default>false</default>
+      <summary>Disables flash</summary>
+      <description>Disables screen flashing on screenshot</description>
     </key>
     <key name="include-icc-profile" type="b">
       <default>true</default>
diff --git a/src/screenshot-application.c b/src/screenshot-application.c
index f7f5022..3759bee 100644
--- a/src/screenshot-application.c
+++ b/src/screenshot-application.c
@@ -612,6 +612,7 @@ static const GOptionEntry entries[] = {
   { "include-border", 'b', 0, G_OPTION_ARG_NONE, NULL, N_("Include the window border with the screenshot. This option is deprecated and window border is always included"), NULL },
   { "remove-border", 'B', 0, G_OPTION_ARG_NONE, NULL, N_("Remove the window border from the screenshot. This option is deprecated and window border is always included"), NULL },
   { "include-pointer", 'p', 0, G_OPTION_ARG_NONE, NULL, N_("Include the pointer with the screenshot"), NULL },
+  { "no-flash", 'F', 0, G_OPTION_ARG_NONE, NULL, N_("Disables flash on screenshot"), NULL },
   { "delay", 'd', 0, G_OPTION_ARG_INT, NULL, N_("Take screenshot after specified delay [in seconds]"), N_("seconds") },
   { "border-effect", 'e', 0, G_OPTION_ARG_STRING, NULL, N_("Effect to add to the border (‘shadow’, ‘border’, ‘vintage’ or ‘none’). Note: This option is deprecated and is assumed to be ‘none’"), N_("effect") },
   { "interactive", 'i', 0, G_OPTION_ARG_NONE, NULL, N_("Interactively set options"), NULL },
@@ -645,6 +646,7 @@ screenshot_application_command_line (GApplication            *app,
   gboolean disable_border_arg = FALSE;
   gboolean include_pointer_arg = FALSE;
   gboolean interactive_arg = FALSE;
+  gboolean no_flash_arg = screenshot_config->no_flash;
   gchar *border_effect_arg = NULL;
   guint delay_arg = 0;
   gchar *file_arg = NULL;
@@ -659,6 +661,7 @@ screenshot_application_command_line (GApplication            *app,
   g_variant_dict_lookup (options, "include-border", "b", &include_border_arg);
   g_variant_dict_lookup (options, "remove-border", "b", &disable_border_arg);
   g_variant_dict_lookup (options, "include-pointer", "b", &include_pointer_arg);
+  g_variant_dict_lookup (options, "no-flash", "b", &no_flash_arg);
   g_variant_dict_lookup (options, "interactive", "b", &interactive_arg);
   g_variant_dict_lookup (options, "border-effect", "&s", &border_effect_arg);
   g_variant_dict_lookup (options, "delay", "i", &delay_arg);
@@ -670,6 +673,7 @@ screenshot_application_command_line (GApplication            *app,
                                               include_border_arg,
                                               disable_border_arg,
                                               include_pointer_arg,
+                                              no_flash_arg,
                                               border_effect_arg,
                                               delay_arg,
                                               interactive_arg,
@@ -774,6 +778,7 @@ action_screen_shot (GSimpleAction *action,
                                         FALSE, /* include border */
                                         FALSE, /* disable border */
                                         FALSE, /* include pointer */
+                                        FALSE, /* no flash*/
                                         NULL,  /* border effect */
                                         0,     /* delay */
                                         FALSE, /* interactive */
@@ -794,6 +799,7 @@ action_window_shot (GSimpleAction *action,
                                         FALSE, /* include border */
                                         FALSE, /* disable border */
                                         FALSE, /* include pointer */
+                                        FALSE, /* no flash*/
                                         NULL,  /* border effect */
                                         0,     /* delay */
                                         FALSE, /* interactive */
diff --git a/src/screenshot-backend-shell.c b/src/screenshot-backend-shell.c
index 84c5ead..7324666 100644
--- a/src/screenshot-backend-shell.c
+++ b/src/screenshot-backend-shell.c
@@ -60,7 +60,7 @@ screenshot_backend_shell_get_pixbuf (ScreenshotBackend *backend,
       method_params = g_variant_new ("(bbbs)",
                                      TRUE,
                                      screenshot_config->include_pointer,
-                                     TRUE, /* flash */
+                                     !screenshot_config->no_flash, /* flash */
                                      filename);
     }
   else if (rectangle != NULL)
@@ -69,7 +69,7 @@ screenshot_backend_shell_get_pixbuf (ScreenshotBackend *backend,
       method_params = g_variant_new ("(iiiibs)",
                                      rectangle->x, rectangle->y,
                                      rectangle->width, rectangle->height,
-                                     TRUE, /* flash */
+                                     !screenshot_config->no_flash, /* flash */
                                      filename);
     }
   else
@@ -77,7 +77,7 @@ screenshot_backend_shell_get_pixbuf (ScreenshotBackend *backend,
       method_name = "Screenshot";
       method_params = g_variant_new ("(bbs)",
                                      screenshot_config->include_pointer,
-                                     TRUE, /* flash */
+                                     !screenshot_config->no_flash, /* flash */
                                      filename);
     }
 
diff --git a/src/screenshot-config.c b/src/screenshot-config.c
index 9fb1387..5b1b5ad 100644
--- a/src/screenshot-config.c
+++ b/src/screenshot-config.c
@@ -32,6 +32,7 @@
 #define AUTO_SAVE_DIRECTORY_KEY "auto-save-directory"
 #define LAST_SAVE_DIRECTORY_KEY "last-save-directory"
 #define DEFAULT_FILE_TYPE_KEY   "default-file-type"
+#define NO_FLASH_KEY             "no-flash"
 
 ScreenshotConfig *screenshot_config;
 
@@ -52,6 +53,9 @@ screenshot_load_config (void)
   config->include_pointer =
     g_settings_get_boolean (config->settings,
                             INCLUDE_POINTER_KEY);
+  config->no_flash =
+    g_settings_get_boolean (config->settings,
+                            NO_FLASH_KEY);
   config->file_type =
     g_settings_get_string (config->settings,
                            DEFAULT_FILE_TYPE_KEY);
@@ -91,6 +95,7 @@ screenshot_config_parse_command_line (gboolean clipboard_arg,
                                       gboolean include_border_arg,
                                       gboolean disable_border_arg,
                                       gboolean include_pointer_arg,
+                                      gboolean no_flash_arg,
                                       const gchar *border_effect_arg,
                                       guint delay_arg,
                                       gboolean interactive_arg,
@@ -143,6 +148,6 @@ screenshot_config_parse_command_line (gboolean clipboard_arg,
 
   screenshot_config->take_window_shot = window_arg;
   screenshot_config->take_area_shot = area_arg;
-
+  screenshot_config->no_flash = no_flash_arg;
   return TRUE;
 }
diff --git a/src/screenshot-config.h b/src/screenshot-config.h
index fdf77a9..5cfcea3 100644
--- a/src/screenshot-config.h
+++ b/src/screenshot-config.h
@@ -38,6 +38,7 @@ typedef struct {
 
   gboolean include_pointer;
   gboolean include_icc_profile;
+  gboolean no_flash;
 
   guint delay;
 
@@ -54,6 +55,7 @@ gboolean    screenshot_config_parse_command_line  (gboolean clipboard_arg,
                                                    gboolean include_border_arg,
                                                    gboolean disable_border_arg,
                                                    gboolean include_pointer_arg,
+                                                   gboolean no_flash,
                                                    const gchar *border_effect_arg,
                                                    guint delay_arg,
                                                    gboolean interactive_arg,
-- 
GitLab

